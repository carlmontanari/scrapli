name: Commit

on: [push]


jobs:
  build_linux:
    runs-on: ${{ matrix.os }}
    strategy:
      max-parallel: 6
      matrix:
        os: [ubuntu-latest]
        version: [3.6, 3.7, 3.8]
    steps:
      - uses: actions/checkout@v2
      - name: set up python ${{ matrix.version }}
        uses: actions/setup-python@v2
        with:
          python-version: ${{ matrix.version }}
      - name: install openssh-client
        run: |
          sudo apt-get update -y
          sudo apt-get install -y openssh-client
      - name: setup test env
        run: |
          python -m pip install --upgrade pip
          python -m pip install setuptools
          python -m pip install nox
          python -m pip install asyncssh
          python -m pip install -e .
          chmod 0600 tests/test_data/files/vrnetlab_key
      - name: run test stuff
        run: |
          nohup python tests/start_ssh_server.py &
          python tests/stream_log_ssh.py


#jobs:
#  build_linux:
#    runs-on: ${{ matrix.os }}
#    strategy:
#      max-parallel: 6
#      matrix:
#        os: [ubuntu-latest]
#        version: [3.6, 3.7, 3.8]
#    steps:
#      - uses: actions/checkout@v2
#      - name: set up python ${{ matrix.version }}
#        uses: actions/setup-python@v2
#        with:
#          python-version: ${{ matrix.version }}
#      - name: install openssh-client
#        run: |
#          sudo apt-get update -y
#          sudo apt-get install -y openssh-client
#      - name: setup test env
#        run: |
#          python -m pip install --upgrade pip
#          python -m pip install setuptools
#          python -m pip install nox
#          chmod 0600 tests/test_data/files/vrnetlab_key
#      - name: run nox
#        run: python -m nox

#  build_macos:
#    runs-on: ${{ matrix.os }}
#    strategy:
#      max-parallel: 6
#      matrix:
#        os: [macos-latest]
#        version: [3.6, 3.7, 3.8]
#    steps:
#      - uses: actions/checkout@v2
#      - name: set up python ${{ matrix.version }}
#        uses: actions/setup-python@v2
#        with:
#          python-version: ${{ matrix.version }}
#      - name: install openssh-client
#        run: |
#          sudo apt-get update -y
#          sudo apt-get install -y openssh-client
#      - name: setup test env
#        run: |
#          python -m pip install --upgrade pip
#          python -m pip install setuptools
#          python -m pip install nox
#      - name: run nox
#        run: python -m nox

#  # no ssh2 for windows python3.8, so just peeling this out into its own job for now and running just py37 tests
#  build_windows:
#    runs-on: ${{ matrix.os }}
#    strategy:
#      max-parallel: 1
#      matrix:
#        os: [windows-latest]
#        version: [3.7]
#    steps:
#      - uses: actions/checkout@v2
#      - name: set up python ${{ matrix.version }}
#        uses: actions/setup-python@v2
#        with:
#          python-version: ${{ matrix.version }}
#      - name: setup test env
#        run: |
#          python -m pip install --upgrade pip
#          python -m pip install setuptools
#          python -m pip install nox
#      - name: run nox
#        run: python -m nox -e unit_tests-3.7
